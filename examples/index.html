<html>
<head>
  <meta charset="utf-8">
  <title>PoC</title>
</head>
<body>

  <ul id="user-save-flow"></ul>
  <!-- <button id="user-update" onclick="update()">Update user</button> -->

  <script src="../dist/hooksjs.min.js"></script>
  <script>
    const { Hooks } = Hooksjs;

    class View {
      constructor() {
        this.hooks = new Hooks(this);
        this.rootElement = document.getElementById('user-save-flow');
      }

      _cleanRootElement() {
        while (this.rootElement.firstChild) {
          this.rootElement.removeChild(this.rootElement.firstChild);
        }
      }

      _renderItem(item = {}) {
        // console.log('_renderItem', item)
        const { description, id, name, lastName } = item;
        const node = document.createElement('LI');
        const textnode = document.createTextNode([description, name, lastName].join(' '));
        node.appendChild(textnode);
        this.rootElement.appendChild(node);
      }

      getData() {
        return this.data || {};
      }

      setData(data) {
        this.data = data;
        // console.log('View::setData', this.getData());
        this.render();
      }

      render() {
        // console.log('View::render', this.data);
        this._renderItem(this.getData());
      }
    }

    class Model {
      constructor(data) {
        this.data = data;
        this.hooks = new Hooks(this);
        this.view = new View(this.data);
        this._setupLifeCycle();
      }

      _setupLifeCycle() {
        this.hooks.pre('save', () => this.view.setData({ description: 'PRE SAVE' }))
          .post('save', () => this.view.setData(this.data))
          .post('save', () => this.view.setData({ description: 'POST SAVE' }));

        this.hooks.pre('update', () => this.view.setData({ description: 'PRE UPDATE' }))
          .pre('update', () => { this.view.setData(this.data); })
          .post('update', () => { this.view.setData({ description: 'POST UPDATE' }); });
      }

      save() {
        console.log('save', this.data);
        return this.data;
      }

      update(data) {
        console.log('update', data);
        this.data = data;
      }
    }

    const user = new Model({ name: 'John', lastName: 'Doe' });
    user.save();
    user.update({ name: 'João', lastName: 'Neto' });

    // function update() {
    //   const data = { name: 'João', lastName: 'Neto' };
    //   user.update(data);
    // }

  </script>
</body>
</html>
