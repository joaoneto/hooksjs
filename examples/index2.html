<html>
<head>
  <meta charset="utf-8">
  <title>PoC</title>
</head>
<body>

  <ul id="user-save-flow"></ul>
  <button id="user-update" onclick="update()">Update user</button>

  <script src="../dist/hooksjs.min.js"></script>
  <script>
    const { Hooks } = Hooksjs;

    class View {
      constructor() {
        this.hooks = new Hooks(this);
        this.rootElement = document.getElementById('user-save-flow');
      }

      _cleanRootElement() {
        while (this.rootElement.firstChild) {
          this.rootElement.removeChild(this.rootElement.firstChild);
        }
      }

      _renderItem(item = {}) {
        const { description, name, lastName } = item;
        const node = document.createElement('LI');
        const textnode = document.createTextNode([description, name, lastName].join(' '));

        node.appendChild(textnode);
        this.rootElement.appendChild(node);
      }

      getData() {
        return this.data || {};
      }

      setData(data) {
        this.data = data;
        console.log('View::setData', this.getData());
        this.render();
      }

      render() {
        // console.log('View::render', this.data);
        this._renderItem(this.getData());
      }
    }

    class Model {
      constructor(data) {
        this.view = new View(this.data);
        this.hooks = new Hooks(this);
        this.setData(data);
        this._setupLifeCycle();
      }

      getData() {
        return this.data || {};
      }

      setData(data) {
        this.data = data || {};
      }

      _setupLifeCycle() {
        this.hooks.pre('save', () => this.view.setData({ description: 'PRE SAVE' }));
        this.hooks.post('save', () => this.view.setData(this.getData()));
        this.hooks.post('save', () => this.view.setData({ description: 'POST SAVE' }));

        this.hooks.pre('update', () => this.view.setData({ description: 'PRE UPDATE' }));
        this.hooks.pre('update', () => { this.view.setData(this.getData())});
        this.hooks.post('update', () => this.view.setData({ description: 'POST UPDATE' }));
      }

      save() {
        console.log('Model::save', this.data);
        return this.data;
      }

      update(data) {
        this.setData(data);
        console.log('Model::update', this.data);
      }
    }

    const user = new Model({ name: 'John', lastName: 'Doe' });
    user.save();

    function update() {
      const data = { name: 'Jo√£o', lastName: 'Neto' };
      user.update(data);
    }

  </script>
</body>
</html>
